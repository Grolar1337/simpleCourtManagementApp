<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <!--<script src="https://cdn.jsdelivr.net/npm/@preline/accordion@2.3.0/index.min.js"></script>-->
</head>

<body class="bg-gray-100">

  <div class=" mb-4">
    <div class="sm:hidden">
      <label for="Tab" class="sr-only">Tab</label>

      <select id="Tab" class="w-full rounded-md border-gray-200">
        <option selected>Takvim</option>
        <option>Ayarlar</option>

      </select>
    </div>

    <div class="ml-36 mb-6 mt-4">



      <div>
        <div class="sm:hidden">
          <label for="Tab" class="sr-only">Tab</label>

          <select id="Tab" class="w-full rounded-md border-gray-200">
            <option selected>Takvim</option>
            <option>Ayarlar</option>
          </select>
        </div>

        <div class="hidden sm:block">
          <nav class="flex gap-6" aria-label="Tabs">
            <a href="index.html"
              class="shrink-0 rounded-lg p-2 text-xl font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700">
              Takvim
            </a>

            <a href="account.html"
              class="shrink-0 rounded-lg p-2 text-xl font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700">
              Ayarlar
            </a>


          </nav>
        </div>
      </div>







    </div>

  </div>
  <div class="mt-12 bg-gray-100 flex items-start justify-start">
    <div class="flex lg:w-7/12 md:w-9/12 sm:w-10/12 mx-auto p-4 space-x-4">
      <div class="w-8/12">
        <div class="bg-white shadow-lg rounded-lg overflow-hidden">
          <div class="flex items-center justify-between px-6 py-3 bg-gray-700">
            <button id="prevMonth" class="text-white">Previous</button>
            <h2 id="currentMonth" class="text-white"></h2>
            <button id="nextMonth" class="text-white">Next</button>
          </div>
          <div class="grid grid-cols-7 gap-2 p-4" id="calendar">
            <!-- Calendar Days Go Here -->
          </div>
          <div id="myModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50">
            <div class="modal-overlay absolute inset-0 bg-black opacity-50"></div>
            <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
              <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                  <p class="text-2xl font-bold">Selected Date</p>
                  <button id="closeModal"
                    class="modal-close px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring">✕</button>
                </div>
                <div id="modalDate" class="text-xl font-semibold"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="w-4/12">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="start-time" class="block mb-2 text-sm font-medium text-black">Start time:</label>
            <div class="relative">
              <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd"
                    d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <input type="time" id="start-time"
                class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                min="00:00" max="24:00" value="00:00" required />
            </div>
          </div>
          <div>
            <label for="end-time" class="block mb-2 text-sm font-medium text-black">End time:</label>
            <div class="relative">
              <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd"
                    d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <input type="time" id="end-time"
                class="bg-gray-50 border leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                min="00:00" max="24:00" value="00:00" required />
            </div>
          </div>
        </div>
        <label for="court" class="block mb-2 text-sm font-medium text-black mt-4">Kort seçiniz</label>
        <select id="court"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
        </select>
        <div class="mt-4">
          <label for="message" class="block mb-2 text-sm font-medium text-black">Note</label>
          <textarea id="message" rows="4"
            class="block p-2.5 w-full text-sm text-gray-900 bg-white-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="Write your thoughts here..."></textarea>
        </div>
        <div class="flex justify-end mt-4">
          <button type="submit" id="submit"
            class="px-4 py-2 bg-gray-700 text-white rounded-lg shadow-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">Kaydet</button>
        </div>
      </div>
    </div>

  </div>





  <!--
  <div class="max-w-screen-md w-8/12 p-10  mx-auto hs-accordion-group">
    <div class="hs-accordion active" id="hs-basic-heading-one">
      <button class="hs-accordion-toggle hs-accordion-active:text-blue-600 py-3 inline-flex items-center gap-x-3 w-full font-semibold text-start text-gray-800 hover:text-gray-500 rounded-lg disabled:opacity-50 disabled:pointer-events-none" aria-controls="hs-basic-collapse-one">
        <svg class="hs-accordion-active:hidden block size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        <svg class="hs-accordion-active:block hidden size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
        </svg>
        test
      </button>
      <div id="hs-basic-collapse-one" class="hs-accordion-content w-full overflow-hidden transition-[height] duration-300" aria-labelledby="hs-basic-heading-one">
        <p class="text-gray-800">
          <em>deneme deneme
        </p>
      </div>
    </div>
  
    <div class="hs-accordion" id="hs-basic-heading-two">
      <button class="hs-accordion-toggle hs-accordion-active:text-blue-600 py-3 inline-flex items-center gap-x-3 w-full font-semibold text-start text-gray-800 hover:text-gray-500 rounded-lg disabled:opacity-50 disabled:pointer-events-none" aria-controls="hs-basic-collapse-two">
        <svg class="hs-accordion-active:hidden block size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        <svg class="hs-accordion-active:block hidden size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
        </svg>
        Accordion #2
      </button>
      <div id="hs-basic-collapse-two" class="hs-accordion-content hidden w-full overflow-hidden transition-[height] duration-300" aria-labelledby="hs-basic-heading-two">
        <p class="text-gray-800">
          <em>This is the third item's accordion body.</em> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions.
        </p>
      </div>
    </div>
  
    <div class="hs-accordion" id="hs-basic-heading-three">
      <button class="hs-accordion-toggle hs-accordion-active:text-blue-600 py-3 inline-flex items-center gap-x-3 w-full font-semibold text-start text-gray-800 hover:text-gray-500 rounded-lg disabled:opacity-50 disabled:pointer-events-none" aria-controls="hs-basic-collapse-three">
        <svg class="hs-accordion-active:hidden block size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        <svg class="hs-accordion-active:block hidden size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"></path>
        </svg>
        Accordion #3
      </button>
      <div id="hs-basic-collapse-three" class="hs-accordion-content hidden w-full overflow-hidden transition-[height] duration-300" aria-labelledby="hs-basic-heading-three">
        <p class="text-gray-800">
          <em>This is the third item's accordion body.</em> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions.
        </p>
      </div>
    </div>
  </div>  -->

  <div class="max-w-screen-md w-8/12 p-10  mx-auto hs-accordion-group" id="accordionContainer">
    <!-- Accordion content will be inserted here -->
  </div>







  <script>
    // Function to generate the calendar for a specific month and year
    function generateCalendar(year, month) {
      const calendarElement = document.getElementById('calendar');
      const currentMonthElement = document.getElementById('currentMonth');

      // Create a date object for the first day of the specified month
      const firstDayOfMonth = new Date(year, month, 1);
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // Clear the calendar
      calendarElement.innerHTML = '';

      // Set the current month text
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      currentMonthElement.innerText = `${monthNames[month]} ${year}`;

      // Calculate the day of the week for the first day of the month (0 - Sunday, 1 - Monday, ..., 6 - Saturday)
      const firstDayOfWeek = firstDayOfMonth.getDay();

      // Create headers for the days of the week
      const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      daysOfWeek.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.className = 'text-center font-semibold';
        dayElement.innerText = day;
        calendarElement.appendChild(dayElement);
      });

      // Create empty boxes for days before the first day of the month
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyDayElement = document.createElement('div');
        calendarElement.appendChild(emptyDayElement);
      }

      // Create boxes for each day of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'text-center py-2 border cursor-pointer';
        dayElement.innerText = day;

        // Check if this date is the current date
        const currentDate = new Date();
        if (year === currentDate.getFullYear() && month === currentDate.getMonth() && day === currentDate.getDate()) {
          //dayElement.classList.add('bg-blue-500', 'text-white'); // Add classes for the indicator
        }

        calendarElement.appendChild(dayElement);
      }
    }

    // Initialize the calendar with the current month and year
    const currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth();
    generateCalendar(currentYear, currentMonth);
    fetchBookings(currentYear, currentMonth);

    // Event listeners for previous and next month buttons
    document.getElementById('prevMonth').addEventListener('click', async () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      await fetchBookings(currentYear, currentMonth);
      generateCalendar(currentYear, currentMonth);
    });

    document.getElementById('nextMonth').addEventListener('click', async () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      await fetchBookings(currentYear, currentMonth);
      generateCalendar(currentYear, currentMonth);
    });

    let formattedDate
    let selectedDate
    const calendar = document.getElementById('calendar');

    calendar.addEventListener('click', (event) => {
      const dayElement = event.target;
      if (dayElement.classList.contains('cursor-pointer')) {
        const day = parseInt(dayElement.innerText);
        selectedDate = new Date(currentYear, currentMonth, day);
        console.log(selectedDate);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        formattedDate = selectedDate.toLocaleDateString(undefined, options);
        showBookingsForDay(selectedDate);

        document.querySelectorAll('.cursor-pointer').forEach(el => {
          el.classList.remove('bg-blue-500', 'text-white');
        });
        console.log(formattedDate);
        dayElement.classList.add('bg-blue-500', 'text-white');
      }
    });

    let bookings = [];
    async function fetchBookings(year, month) {
      const apiUrl = `http://127.0.0.1:10000/api/schedule?year=${year}&month=${month + 1}`;
      const response = await fetch(apiUrl);
      const data = await response.json();
      bookings = data; // Store the fetched bookings data

      
      const courtSelect = document.getElementById('court');
      courtSelect.innerHTML = '';
      bookings.courts.forEach(function (court) {
        const option = document.createElement('option');
        option.value = court;
        option.textContent = court;
        courtSelect.appendChild(option);
      });
    }


    function showBookingsForDay(selectedDate) {
      const accordionContainer = document.getElementById('accordionContainer');
      accordionContainer.innerHTML = '';
      console.log(selectedDate);
      //const time = new Date(booking.s_time);
      //const bookingsForDay = Object.values(bookings.bookings).filter(booking => booking.s_time  === selectedDate.getDate());


      const bookingsForDay = Object.values(bookings.bookings).filter(booking => {

        const bookingDate = new Date(booking.s_time);
        console.log(bookingDate);
        return bookingDate.getDate() === selectedDate.getDate();
      });
      if (bookingsForDay.length === 0) {
        accordionContainer.innerHTML = '<p class="text-center text-gray-500">No bookings for this day.</p>';
        return;
      }
      console.log(bookingsForDay);
      bookingsForDay.forEach((booking, index) => {
        console.log(booking);
        console.log(booking);
        const accordionItem = document.createElement('div');
        accordionItem.className = 'hs-accordion';

        const e_dateObj = new Date(booking.e_time);

        const e_hour = e_dateObj.getHours(); 
        let e_minute = e_dateObj.getMinutes(); 
        if (e_minute < 10) { e_minute = '0' + e_minute;}

        const s_dateObj = new Date(booking.s_time);

        const s_hour = s_dateObj.getHours(); 
        let s_minute = s_dateObj.getMinutes(); 
        if (s_minute < 10) { s_minute = '0' + s_minute;}

        const accordionHeader = document.createElement('button');
        accordionHeader.className = 'hs-accordion-toggle hs-accordion-active:text-blue-600 py-3 inline-flex items-center gap-x-3 w-full font-semibold text-start text-gray-800 hover:text-gray-500 rounded-lg disabled:opacity-50 disabled:pointer-events-none';
        accordionHeader.innerHTML = `

              
              <svg class="hs-accordion-active:hidden block size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
                <path d="M12 5v14"></path>
              </svg>
              <svg class="hs-accordion-active:block hidden size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
              </svg>
              <p class="text-lg	">${s_hour}:${s_minute} - ${e_hour}:${e_minute} arasinda kort dolu</p>

          


        
        `;

        const accordionBody = document.createElement('div');
        accordionBody.className = 'hs-accordion-content w-full overflow-hidden transition-[height] duration-300';

        const accordionText = document.createElement('p');
        accordionText.className = 'text-gray-800';
        accordionText.innerHTML = booking.note;

        accordionBody.appendChild(accordionText);
        accordionItem.appendChild(accordionHeader);
        accordionItem.appendChild(accordionBody);
        accordionContainer.appendChild(accordionItem);
        accordionHeader.addEventListener('click', () => {
          const isOpen = accordionItem.classList.contains('active');

          if (isOpen) {
            // Akordeon kapanacak
            accordionItem.classList.remove('active');
            accordionBody.style.maxHeight = '0px';
          } else {
            // Akordeon açılacak
            accordionItem.classList.add('active');
            accordionBody.style.maxHeight = accordionBody.scrollHeight + 'px';
          }
          accordionHeader.querySelectorAll('svg').forEach(svg => {
        svg.classList.toggle('hidden');
        svg.classList.toggle('block');
    });

        });


      });

    }







    document.getElementById('submit').addEventListener('click', () => {
      const startTime = document.getElementById('start-time').value;
      const endTime = document.getElementById('end-time').value;
      const note = document.getElementById('message').value;
      const court = document.getElementById('court').value;

      console.log(formattedDate);
      const data = {
        date: { "day": selectedDate.getDate(), "month": selectedDate.getMonth(), "year": selectedDate.getFullYear() },
        startTime: startTime,
        endTime: endTime,
        note: note,
        court: court
      };
      console.log(data);
      fetch('http://127.0.0.1:10000/api/schedule', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
        })
        .catch(error => {
          console.error('Error:', error);
        });
    });

  </script>

<style>
  .hs-accordion-content {
     max-height: 0;
     overflow: hidden;
     transition: max-height 0.3s ease-out; /* İstenen süreyi ve geçiş efektini buradan ayarlayabilirsiniz */
 }
</style>
</body>

</html>